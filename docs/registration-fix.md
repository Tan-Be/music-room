# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ù–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Music Room.

## üîç –ü—Ä–∏—á–∏–Ω–∞

–§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—ã—Ç–∞–ª–∞—Å—å –≤—ã–∑–≤–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏—é `create_user_profile`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Supabase.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª—ë–Ω –∫–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `src/lib/auth.ts`

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ INSERT –≤–º–µ—Å—Ç–æ RPC:

```typescript
// –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
if (data.user) {
  const success = await retryMutation(async () => {
    const { error: profileError } = await supabase.from('profiles').insert({
      id: data.user.id,
      username: username,
      avatar_url: null,
      spotify_id: null,
      tracks_added_today: 0,
      last_track_date: new Date().toISOString().split('T')[0],
    })

    if (profileError) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      if (profileError.code !== '23505') {
        throw profileError
      }
    }
  })
}
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–§–∞–π–ª:** `src/app/(auth)/register/page.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:

- ‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞
- ‚úÖ –ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

### 3. –°–æ–∑–¥–∞–Ω SQL —Ç—Ä–∏–≥–≥–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª:** `docs/supabase-profile-trigger.sql`

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä–∞ (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)

–ü—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –ø—Ä–æ—Ñ–∏–ª—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –° —Ç—Ä–∏–≥–≥–µ—Ä–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `docs/supabase-profile-trigger.sql`
4. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
5. –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ñ–∏–ª—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env.local` —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É profiles

–í Supabase Dashboard ‚Üí Table Editor ‚Üí profiles –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:

- `id` (uuid, primary key)
- `username` (text)
- `avatar_url` (text, nullable)
- `spotify_id` (text, nullable)
- `tracks_added_today` (integer)
- `last_track_date` (date)
- `created_at` (timestamp)
- `updated_at` (timestamp)

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏

–í Supabase Dashboard ‚Üí Authentication ‚Üí Policies –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `profiles`:

- ‚úÖ SELECT: –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º
- ‚úÖ INSERT: —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ UPDATE: —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: `http://localhost:3000/register`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞
   - Email: –≤–∞–ª–∏–¥–Ω—ã–π email
   - –ü–∞—Ä–æ–ª—å: –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è: –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å
3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
4. –í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/rooms`

## ‚ùó –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

### "User already registered"

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π email –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ `/login`

### "Invalid email"

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç email (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @)

### "Password should be at least 6 characters"

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª–∏–Ω–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤

### "Failed to create profile"

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Ç—Ä–∏–≥–≥–µ—Ä –∏–∑ `docs/supabase-profile-trigger.sql`

## üìä –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –î–æ                | –ü–æ—Å–ª–µ                 |
| ---------------- | ----------------- | --------------------- |
| –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è | ‚ùå RPC —Ñ—É–Ω–∫—Ü–∏—è    | ‚úÖ –ü—Ä—è–º–æ–π INSERT      |
| –í–∞–ª–∏–¥–∞—Ü–∏—è        | ‚ùå –¢–æ–ª—å–∫–æ alert   | ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è        | ‚úÖ –° retry –ª–æ–≥–∏–∫–æ–π    |
| –î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è     | ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å | ‚úÖ –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤ |
| –î–ª–∏–Ω–∞ username   | ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å | ‚úÖ –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞  |

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ:

- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OAuth (Google, GitHub, Spotify)

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 27 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
